<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Document Search & Summarization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .meeder-blue { color: #002D5B; }
        .meeder-accent { color: #007BFF; }
        .spinner {
            border: 2px solid rgba(0, 0, 0, 0.1);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border-left-color: #007BFF;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #chat-window {
            scroll-behavior: smooth;
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        <header class="text-center mb-6 relative">
            <h1 class="text-3xl md:text-4xl font-bold meeder-blue">Intelligent Document Search</h1>
            <p class="text-lg text-gray-600 mt-2">Ask questions about your internal knowledge base.</p>
             <button id="info-btn" class="absolute top-0 right-0 bg-gray-200 text-gray-600 rounded-full p-2 hover:bg-gray-300 transition-colors">
                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.852l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                </svg>
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Document Library -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-xl border border-gray-200 p-6">
                    <h2 class="text-xl font-bold meeder-blue border-b pb-2">Document Library</h2>
                    <div id="doc-library" class="mt-4 space-y-3">
                        <!-- Documents will be populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Chat Container -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-xl border border-gray-200 flex flex-col h-[70vh]">
                    <div id="chat-window" class="flex-1 p-6 overflow-y-auto"></div>
                    <div id="typing-indicator" class="p-6 pt-0 hidden">
                        <div class="flex items-center">
                            <div class="spinner"></div>
                            <p class="ml-3 text-gray-500 text-sm">Assistant is searching...</p>
                        </div>
                    </div>
                    <div class="p-4 border-t bg-gray-50">
                        <div class="flex items-center bg-white border rounded-lg p-2">
                            <input type="text" id="chat-input" class="flex-1 px-2 border-none focus:ring-0 outline-none" placeholder="e.g., 'Summarize the Compliance Manual'">
                            <button id="send-btn" class="bg-[#007BFF] text-white rounded-md p-2 hover:bg-blue-700 transition-colors">
                                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Info Modal -->
    <div id="info-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col transform scale-95">
            <div class="flex justify-between items-center p-4 border-b"><h3 class="text-xl font-bold meeder-blue">How to Use & Future Vision</h3><button id="close-info-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button></div>
            <div class="p-6 overflow-y-auto space-y-8">
                <div>
                    <h4 class="text-lg font-bold meeder-blue mb-2">How to Use This Prototype</h4>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700">
                        <li><strong>Review the Document Library:</strong> See the mock documents the AI has access to on the left.</li>
                        <li><strong>Ask a Question:</strong> Ask a specific question about the content within the documents. Try these prompts:
                            <ul class="list-disc list-inside ml-6 mt-1 text-sm">
                                <li>"What is the policy on using social media for marketing?"</li>
                                <li>"Summarize the Investment Strategy Whitepaper."</li>
                                <li>"What are the key risks mentioned in the Q3 Market Outlook?"</li>
                            </ul>
                        </li>
                        <li><strong>Check the Source:</strong> Notice how the AI's answer includes a citation, telling you exactly which document the information came from.</li>
                    </ol>
                </div>
                <div>
                    <h4 class="text-lg font-bold meeder-blue mb-2">Future Enhancements: A Strategic Roadmap</h4>
                    <p class="text-gray-700 mb-4">This prototype is the foundation. Here is how this tool would evolve into a central knowledge hub for the entire firm:</p>
                    <ul class="space-y-4">
                        <li class="flex items-start"><strong class="w-1/3 meeder-blue">Real-Time Data Ingestion:</strong><span class="w-2/3 text-gray-700">Connect to internal systems like SharePoint, Confluence, and shared drives to automatically index new documents as they are created.</span></li>
                        <li class="flex items-start"><strong class="w-1/3 meeder-blue">Multi-Modal Search:</strong><span class="w-2/3 text-gray-700">Enable the AI to search not just text documents, but also the content of presentations (PPTs), spreadsheets (XLSX), and even transcripts from recorded meetings.</span></li>
                        <li class="flex items-start"><strong class="w-1/3 meeder-blue">Access Control Integration:</strong><span class="w-2/3 text-gray-700">Integrate with the company's user directory to ensure the AI only provides answers from documents that the specific employee is authorized to view.</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- PASTE YOUR API KEY HERE ---
        const geminiApiKey = "AIzaSyDnyrh8HCg1fOQAm_D4NaZMOclXU8og3zs";

        // --- DOM ELEMENTS ---
        const chatWindow = document.getElementById('chat-window');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');
        const docLibrary = document.getElementById('doc-library');
        const infoModal = document.getElementById('info-modal');
        const infoBtn = document.getElementById('info-btn');
        const closeInfoModalBtn = document.getElementById('close-info-modal-btn');

        // --- MOCK DOCUMENT KNOWLEDGE BASE ---
        const knowledgeBase = {
            "Compliance_Manual_v2.pdf": {
                title: "Compliance Manual v2.pdf",
                content: "All marketing materials, including social media posts, must be reviewed and approved by the compliance department before publication. Promissory language, such as guaranteeing returns, is strictly forbidden. All performance data must be accompanied by a disclaimer stating that past performance is not indicative of future results."
            },
            "Investment_Strategy_Whitepaper_Q3.pdf": {
                title: "Investment Strategy Whitepaper Q3.pdf",
                content: "Our core investment thesis for Q3 revolves around a defensive posture in equities, with an overweight position in the healthcare and consumer staples sectors. We are cautious on high-growth technology stocks due to macroeconomic headwinds. In fixed income, we favor short-duration, high-quality corporate bonds."
            },
            "Q3_Market_Outlook.pptx": {
                title: "Q3 Market Outlook.pptx",
                content: "Key risks for the third quarter include persistent inflation, geopolitical instability in Eastern Europe, and potential supply chain disruptions. We are monitoring central bank policy closely, as aggressive interest rate hikes could trigger a recession. Our outlook remains cautiously optimistic, but we advise clients to prepare for increased market volatility."
            }
        };

        // --- INITIALIZATION ---
        function initialize() {
            sendBtn.addEventListener('click', handleUserInput);
            chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleUserInput(); });
            infoBtn.addEventListener('click', showInfoModal);
            closeInfoModalBtn.addEventListener('click', hideInfoModal);
            
            populateDocLibrary();
            addMessage('assistant', "Hello! I have access to the documents in the library. How can I help you today?");
        }

        // --- UI & MESSAGE HANDLING ---
        function populateDocLibrary() {
            for (const key in knowledgeBase) {
                const doc = knowledgeBase[key];
                const docElement = document.createElement('div');
                docElement.className = 'flex items-center bg-gray-100 p-2 rounded-md';
                docElement.innerHTML = `<svg class="h-6 w-6 text-gray-500 mr-2 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                                      <span class="text-sm truncate">${doc.title}</span>`;
                docLibrary.appendChild(docElement);
            }
        }

        function addMessage(sender, message) {
            const messageElement = document.createElement('div');
            let formattedMessage = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            messageElement.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'} mb-4`;
            messageElement.innerHTML = `<div class="${sender === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'} rounded-lg py-2 px-4 max-w-lg">${formattedMessage}</div>`;
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }
        
        function showInfoModal() {
            infoModal.classList.remove('hidden');
            setTimeout(() => {
                infoModal.classList.remove('opacity-0');
                infoModal.querySelector('.modal-content').classList.remove('scale-95');
            }, 10);
        }

        function hideInfoModal() {
            infoModal.classList.add('opacity-0');
            infoModal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => infoModal.classList.add('hidden'), 300);
        }

        // --- CORE LOGIC ---
        async function handleUserInput() {
            const userInput = chatInput.value.trim();
            if (!userInput) return;

            addMessage('user', userInput);
            chatInput.value = '';
            typingIndicator.classList.remove('hidden');

            const knowledgeBaseText = Object.values(knowledgeBase).map(doc => `**Document: ${doc.title}**\n${doc.content}`).join('\n\n---\n\n');

            const prompt = `
                You are an AI assistant for Meeder Investments. Your task is to answer questions based ONLY on the content of the internal documents provided. Do not use any external knowledge. If the answer is not in the documents, say so.
                
                When you find an answer, you MUST cite the source document. For example: "According to the **Compliance_Manual_v2.pdf**, all social media posts must be reviewed by compliance."

                **Internal Documents:**
                ${knowledgeBaseText}

                **User's Question:**
                "${userInput}"
            `;

            try {
                const responseText = await callGemini(prompt);
                addMessage('assistant', responseText);
            } catch (error) {
                addMessage('assistant', "I'm having trouble searching the documents right now. Please try again in a moment.");
            } finally {
                typingIndicator.classList.add('hidden');
            }
        }
        
        // --- GENERIC GEMINI API HANDLER ---
        async function callGemini(prompt, retries = 3, delay = 1000) {
            if (geminiApiKey === "YOUR_API_KEY_HERE") {
                return "AI features are disabled. Please add your Gemini API key to the code to enable them.";
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${geminiApiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("Invalid response structure from API.");
                }
            } catch (error) {
                if (retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return callGemini(prompt, retries - 1, delay * 2);
                } else {
                    console.error("Error calling Gemini API:", error);
                    throw error;
                }
            }
        }

        // --- START THE APP ---
        initialize();
    </script>
</body>
</html>
